<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>

<!-- <canvas id="game" width="600" height="300"></canvas>
  <div>
    <button id="btnL">L</button>
    <button id="btnR">R</button>
</div> -->
</div>
  <canvas id="game" class="border-2 border-white/20 rounded-xl !mb-10 h-[70%] w-full" style="background: rgb(243, 156, 18); "></canvas>
  <!-- <div id="goal-msg" class="absolute  hidden text-4xl font-bold" >goaal!</div> -->
  <div id="end-game" class="absolute hidden text-4xl border-white"></div>
  <div id="pause-game-icon" class="absolute hidden border-white bg-white/20 rounded-xl top-[54%] !m-auto">
    <i class="ti ti-player-pause-filled text-8xl text-white/80 drop-shadow-2xl"></i>
</div>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  let gameState = {
    x: 370,
    y: 250,
    dx: (Math.random() < 0.5 ? -1 : 1) * 2,
    dy: (Math.random() < 0.5 ? -1 : 1) * 2,
    xPaddleLeft: 0,
    yPaddleLeft: 200,
    xPaddleRight: 690,
    yPaddleRight: 200,
    score1: 0,
    score2: 0
  };
  // const ws = new WebSocket("ws://localhost:3003");

  const ws = io('http://localhost:3003');

  ws.onopen = () => {
    console.log("Connected to server âœ…");
  };

  ws.onmessage = (event) => {
    console.log("Message from server:", event.data);
  };
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const radius = 20;
  const speed = 10;
  canvas.width = 700;
  canvas.height = 500;
  let x = canvas.width / 2;
  let y = canvas.height / 2;
  let xPaddleLeft = 0;
  let yPaddleLeft = 0;
  let xPaddleRight = 690;
  let yPaddleRight = 0;

  function clamp(val, min, max) {
    return Math.max(min, Math.min(max, val));
  }

  // ws.on("message", (msg) => {
  //   const data = JSON.parse(msg);
  //   if(data.type == "ballposition"){
  //     // x = data.x;
  //     // y = data.y;
  //     console.loge(data.x);
  //   }
  // })

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.beginPath();
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI * 2);
    ctx.fill();
    ws.onmessage = (ev) => {
      const data = JSON.parse(ev.data);
      // const data = JSON.parse(msg);
      if(data.type == "ballposition"){
        x = data.x;
        y = data.y;
        // console.log(data.x);
        xPaddleLeft = data.xPaddleLeft;
        yPaddleLeft = data.yPaddleLeft;
        yPaddleRight = data.yPaddleRight;
        xPaddleRight = data.xPaddleRight;
      }
      if(data.type === "updatePlayer1"){
        
      }
      if(data.type === "updatePlayer2"){
      }
    }
    ctx.fillStyle = "white";
		ctx.beginPath();
		ctx.roundRect(xPaddleLeft, yPaddleLeft, 10, 100, 5);
		ctx.fill();

		ctx.beginPath();
		ctx.roundRect(xPaddleRight, yPaddleRight, 10, 100, 5);
		ctx.fill();


    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);

  // function moveLeft() {
  //   x -= 10;
  //   // if (ws.readyState === WebSocket.OPEN) {
  //     ws.send(JSON.stringify({ type: "position", x, y }));
  //   // }
  //   }
  
  // function moveRight() {
  //   x += 10;
  //   ws.send(JSON.stringify({ type: "position", x, y }));
  //   }

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    // if (k === "l") moveLeft();
    // if (k === "r") moveRight();
    if(k === "w"){
      yPaddleRight
      // yPaddleLeft -= 10;
      let move = -10;
      // console.log(yPaddleLeft);
      ws.send(JSON.stringify({ type: "position", xPaddleLeft, yPaddleLeft, move})); // up down
    }
    if(k === "s"){
      // yPaddleLeft += 10;
      let move = 10;
      // console.log(yPaddleLeft);
      ws.send(JSON.stringify({ type: "position", xPaddleLeft, yPaddleLeft, move}));
    }
  });


</script>

  
</body>
</html>